apiVersion: v1
kind: ConfigMap
metadata:
  name: microservices-config
  namespace: ecommerce-dev
  labels:
    app: ecommerce
    component: configuration
data:
  # Configuración global de la aplicación
  application.properties: |
    # === Configuración Global Ecommerce Microservices ===
    
    # Configuración de Spring Boot
    spring.application.name=ecommerce-microservices
    spring.profiles.active=production
    
    # Configuración del servidor
    server.port=8080
    server.servlet.context-path=/api/v1
    server.compression.enabled=true
    server.compression.min-response-size=1024
    
    # Configuración de base de datos
    spring.datasource.hikari.maximum-pool-size=20
    spring.datasource.hikari.minimum-idle=5
    spring.datasource.hikari.idle-timeout=300000
    spring.datasource.hikari.max-lifetime=1800000
    spring.datasource.hikari.connection-timeout=30000
    
    # Configuración JPA/Hibernate
    spring.jpa.hibernate.ddl-auto=update
    spring.jpa.show-sql=false
    spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
    spring.jpa.properties.hibernate.format_sql=true
    spring.jpa.properties.hibernate.use_sql_comments=true
    spring.jpa.properties.hibernate.generate_statistics=true
    spring.jpa.properties.hibernate.cache.use_second_level_cache=true
    spring.jpa.properties.hibernate.cache.region.factory_class=org.hibernate.cache.ehcache.EhCacheRegionFactory
    
    # Configuración de Jackson
    spring.jackson.default-property-inclusion=NON_NULL
    spring.jackson.serialization.write-dates-as-timestamps=false
    spring.jackson.time-zone=UTC
    
    # Configuración de seguridad
    spring.security.enabled=true
    spring.security.require-ssl=true
    
    # Configuración de logging
    logging.level.org.springframework.security=INFO
    logging.level.org.hibernate.SQL=DEBUG
    logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
    logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} - %msg%n
    logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
    
    # Configuración de actuator
    management.endpoints.web.exposure.include=health,info,metrics,prometheus
    management.endpoint.health.show-details=when-authorized
    management.metrics.export.prometheus.enabled=true
    management.metrics.distribution.percentiles-histogram.http.server.requests=true
    
    # Configuración de Circuit Breaker
    resilience4j.circuitbreaker.instances.default.failure-rate-threshold=50
    resilience4j.circuitbreaker.instances.default.wait-duration-in-open-state=10s
    resilience4j.circuitbreaker.instances.default.sliding-window-size=10
    resilience4j.circuitbreaker.instances.default.minimum-number-of-calls=5
    
    # Configuración de Rate Limiting
    resilience4j.ratelimiter.instances.default.limit-for-period=100
    resilience4j.ratelimiter.instances.default.limit-refresh-period=1s
    resilience4j.ratelimiter.instances.default.timeout-duration=1s
    
    # Configuración de Retry
    resilience4j.retry.instances.default.max-attempts=3
    resilience4j.retry.instances.default.wait-duration=1s
    resilience4j.retry.instances.default.exponential-backoff-multiplier=2
    
  # Configuración específica de microservicios
  user-service.properties: |
    # === Configuración User Service ===
    spring.application.name=user-service
    server.port=8081
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-users:3306/users_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=users_user
    
    # Configuración JWT específica
    jwt.expiration=86400
    jwt.refresh-expiration=604800
    
    # Configuración de email
    spring.mail.host=smtp.gmail.com
    spring.mail.port=587
    spring.mail.properties.mail.smtp.auth=true
    spring.mail.properties.mail.smtp.starttls.enable=true
    
    # Configuración de validación
    user.password.min-length=8
    user.password.require-uppercase=true
    user.password.require-numbers=true
    user.password.require-special-chars=true
    
  product-service.properties: |
    # === Configuración Product Service ===
    spring.application.name=product-service
    server.port=8082
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-products:3306/products_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=products_user
    
    # Configuración de cache
    spring.cache.type=redis
    spring.redis.host=redis-products
    spring.redis.port=6379
    spring.redis.timeout=2000ms
    spring.cache.redis.time-to-live=3600000
    
    # Configuración de búsqueda
    elasticsearch.host=elasticsearch
    elasticsearch.port=9200
    elasticsearch.protocol=http
    
    # Configuración de imágenes
    file.upload.dir=/uploads/products
    file.upload.max-size=10MB
    file.allowed.types=jpg,jpeg,png,webp
    
  order-service.properties: |
    # === Configuración Order Service ===
    spring.application.name=order-service
    server.port=8083
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-orders:3306/orders_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=orders_user
    
    # Configuración de messaging
    spring.rabbitmq.host=rabbitmq
    spring.rabbitmq.port=5672
    spring.rabbitmq.username=guest
    spring.rabbitmq.virtual-host=/
    
    # Configuración de estados de orden
    order.status.pending=PENDING
    order.status.confirmed=CONFIRMED
    order.status.processing=PROCESSING
    order.status.shipped=SHIPPED
    order.status.delivered=DELIVERED
    order.status.cancelled=CANCELLED
    
    # Configuración de timeouts
    order.timeout.confirmation=300
    order.timeout.processing=3600
    order.timeout.shipping=86400
    
  payment-service.properties: |
    # === Configuración Payment Service ===
    spring.application.name=payment-service
    server.port=8084
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-payments:3306/payments_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=payments_user
    
    # Configuración de procesadores de pago
    payment.stripe.enabled=true
    payment.paypal.enabled=true
    payment.mercadopago.enabled=true
    
    # URLs de webhook (se configuran vía secrets)
    payment.webhook.stripe.endpoint=/webhook/stripe
    payment.webhook.paypal.endpoint=/webhook/paypal
    payment.webhook.mercadopago.endpoint=/webhook/mercadopago
    
    # Configuración de monedas soportadas
    payment.currencies.supported=USD,EUR,MXN,ARS,COP,PEN
    payment.currency.default=USD
    
  shipping-service.properties: |
    # === Configuración Shipping Service ===
    spring.application.name=shipping-service
    server.port=8085
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-shipping:3306/shipping_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=shipping_user
    
    # Configuración de proveedores de envío
    shipping.fedex.enabled=true
    shipping.ups.enabled=true
    shipping.dhl.enabled=true
    shipping.local.enabled=true
    
    # Configuración de cálculo de costos
    shipping.cost.base=5.00
    shipping.cost.per-kg=2.50
    shipping.cost.express-multiplier=2.0
    shipping.cost.international-multiplier=3.0
    
    # Configuración de tracking
    shipping.tracking.update-interval=3600
    shipping.tracking.webhook.enabled=true
    
  favourite-service.properties: |
    # === Configuración Favourite Service ===
    spring.application.name=favourite-service
    server.port=8086
    
    # Database específica
    spring.datasource.url=jdbc:mysql://mysql-favourites:3306/favourites_db?useSSL=true&serverTimezone=UTC
    spring.datasource.username=favourites_user
    
    # Configuración de cache para favoritos
    spring.cache.type=redis
    spring.redis.host=redis-favourites
    spring.redis.port=6379
    spring.cache.redis.time-to-live=7200000
    
    # Configuración de límites
    favourite.max-items-per-user=1000
    favourite.list.max-lists-per-user=10
    favourite.list.max-name-length=100
    
  api-gateway.properties: |
    # === Configuración API Gateway ===
    spring.application.name=api-gateway
    server.port=8080
    
    # Configuración de CORS
    cors.allowed-origins=https://ecommerce-frontend.example.com,https://admin.ecommerce.example.com
    cors.allowed-methods=GET,POST,PUT,DELETE,PATCH,OPTIONS
    cors.allowed-headers=*
    cors.allow-credentials=true
    cors.max-age=3600
    
    # Configuración de Rate Limiting específica
    ratelimit.global.requests-per-minute=1000
    ratelimit.user.requests-per-minute=100
    ratelimit.admin.requests-per-minute=500
    
    # Configuración de routing
    gateway.routes.user-service.path=/api/v1/users/**
    gateway.routes.product-service.path=/api/v1/products/**
    gateway.routes.order-service.path=/api/v1/orders/**
    gateway.routes.payment-service.path=/api/v1/payments/**
    gateway.routes.shipping-service.path=/api/v1/shipping/**
    gateway.routes.favourite-service.path=/api/v1/favourites/**
    
    # Configuración de circuit breaker por servicio
    gateway.circuit-breaker.user-service.enabled=true
    gateway.circuit-breaker.product-service.enabled=true
    gateway.circuit-breaker.order-service.enabled=true
    
  # Configuración de monitoreo
  monitoring.properties: |
    # === Configuración de Monitoreo ===
    
    # Prometheus metrics
    monitoring.prometheus.enabled=true
    monitoring.prometheus.scrape-interval=15s
    
    # Jaeger tracing
    monitoring.jaeger.enabled=true
    monitoring.jaeger.endpoint=http://jaeger-collector:14268/api/traces
    monitoring.jaeger.sampler.type=probabilistic
    monitoring.jaeger.sampler.param=0.1
    
    # Log aggregation
    monitoring.fluentd.enabled=true
    monitoring.fluentd.host=fluentd
    monitoring.fluentd.port=24224
    
    # Health checks
    monitoring.health.interval=30s
    monitoring.health.timeout=10s
    monitoring.health.retries=3
    
  # Configuración de perfiles de entorno
  application-development.properties: |
    # === Perfil de Desarrollo ===
    spring.profiles.active=development
    
    # Debug habilitado
    logging.level.org.springframework=DEBUG
    logging.level.com.ecommerce=DEBUG
    spring.jpa.show-sql=true
    
    # Configuraciones relajadas para desarrollo
    spring.security.require-ssl=false
    jwt.expiration=3600
    
    # Base de datos H2 para desarrollo local
    spring.datasource.url=jdbc:h2:mem:devdb
    spring.datasource.driver-class-name=org.h2.Driver
    spring.h2.console.enabled=true
    
  application-staging.properties: |
    # === Perfil de Staging ===
    spring.profiles.active=staging
    
    # Configuración similar a producción pero con logs más verbosos
    logging.level.org.springframework=INFO
    logging.level.com.ecommerce=INFO
    
    # JWT con menor tiempo de vida para testing
    jwt.expiration=7200
    
    # Rate limiting más permisivo
    ratelimit.global.requests-per-minute=5000
    
  application-production.properties: |
    # === Perfil de Producción ===
    spring.profiles.active=production
    
    # Logging optimizado
    logging.level.org.springframework=WARN
    logging.level.com.ecommerce=INFO
    logging.level.org.hibernate.SQL=ERROR
    
    # Seguridad estricta
    spring.security.require-ssl=true
    jwt.expiration=86400
    
    # Pool de conexiones optimizado
    spring.datasource.hikari.maximum-pool-size=50
    spring.datasource.hikari.minimum-idle=10
    
    # Cache habilitado
    spring.cache.type=redis
    spring.jpa.properties.hibernate.cache.use_second_level_cache=true